<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta name="viewport" content="width=device-width">
<meta name="description" content="fBM with wasm">
<title>Wasm fBM</title>
</head>
<body>
  <div>
    <input type="range" id="hurst" name="hurst" min="0.1" max="2.5" step="0.1" />
    <label for="hurst">Hurst</label>
  </div>
  <div>
    <input type="range" id="octaves" name="octaves" min="1" max="12" />
    <label for="octaves">Octaves</label>
  </div>
  <div>
    <input type="range" id="scale" name="scale" min="1" max="10" />
    <label for="scale">Scale</label>
  </div>
  <div>
  <label for="fade-select">Choose a fade:</label>
  <select name="fade" id="fade-select">
    <option value="none">None</option>
    <option value="hermite">Hermite</option>
    <option value="quintic">Quintic</option>
  </select>
  </div>
  <div>
  <label for="noise-select">Choose a noise:</label>
  <select name="noise" id="noise-select">
    <option value="fbm">fBM</option>
    <option value="ridged">Ridged</option>
    <option value="ridged-multi">Ridged Multi</option>
    <option value="turbulence">Turbulence</option>
  </select>
  </div>
  <div>
    <input type="checkbox" id="warp" name="warp"/>
    <label for="warp">Domain Warp</label>
  </div>
  <div>
    <canvas id="canvas" width="900" height="600">
  </div>
  <script type="module">
    import { draw_fbm } from "./js/fbm.mjs";

    const workers = [
      new Worker(new URL("js/fbm-worker.js", import.meta.url)),
      new Worker(new URL("js/fbm-worker.js", import.meta.url)),
      new Worker(new URL("js/fbm-worker.js", import.meta.url)),
      new Worker(new URL("js/fbm-worker.js", import.meta.url)),
    ];

    let scale = 0.005;
    let H = Math.SQRT1_2;
    let num_octaves = 12;
    let fade = 'none';
    let noise_type = 'fbm';
    let x = 15;
    let y = 15;

    const redraw = function() {
      let warp = document.getElementById("warp").checked;
      draw_fbm(workers, canvas, scale, num_octaves, H, fade, noise_type, warp, x, y);
    }

    const fade_select = document.getElementById('fade-select');
    fade_select.addEventListener("change", () => {
      fade = fade_select.value;
      redraw();
    });

    const noise_select = document.getElementById('noise-select');
    noise_select.addEventListener("change", () => {
      noise_type = noise_select.value;
      redraw();
    });

    const hurst_slider = document.getElementById('hurst');
    hurst_slider.addEventListener("input", (event) => {
      H = event.target.value;
      redraw();
    });

    const octaves_slider = document.getElementById('octaves');
    octaves_slider.addEventListener("input", (event) => {
      num_octaves = event.target.value;
      redraw();
    });

    const scale_slider = document.getElementById('scale');
    scale_slider.addEventListener("input", (event) => {
      scale = event.target.value / 1000;
      redraw();
    });

    document.getElementById("warp").addEventListener("change", () => {
      redraw();
    });

    const canvas = document.getElementById('canvas');
    canvas.addEventListener("mousedown", (e) => {
      if (e.button == 0) {
        const dx = e.offsetX * scale - x;
        const dy = e.offsetY * scale - y;
        x += dx;
        y += dy;
        redraw();
      }
    });
    redraw();
  </script>
</body>
